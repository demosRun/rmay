<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <!-- 页面的元信息 -->
  <title>{TAG_14226_TAG}</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=1000, user-scalable=yes" />
  <meta name="format-detection" content="telephone=no, email=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="white" />
  <meta name="renderer" content="webkit" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="filetype" content="1" />
  <meta name="publishedtype" content="1" />
  <meta name="pagetype" content="2" />
  <meta name="description" content="{TAG_59447_TAG}" />
  <meta name="keywords" content="{TAG_59446_TAG}" />
  <meta name="catalogs" content="{TAG_83943_TAG}" />

  <!-- 页面主样式文件 -->
  <link charset="utf-8" rel="stylesheet" href="./static/css/owo.core.032e33zk8rgf.css">

  <!-- 附属css文件 -->
  <link rel="stylesheet" href="./static/css/main.css" charset="utf-8">
  <link rel="stylesheet" href="./static/resource/idangerous.swiper2.7.6.css" charset="utf-8">

</head>

<body>

  <!-- 页面[page]-->
  <div class="home page" template="page" style="display: block;">
    <div class="w1200 conn">
      <div class="main clear">
        <div class="fl">
          <div class="swiper-box" template="module12">
            <div class="swiper-container clear">
              <div class="swiper-wrapper">
                <div class="swiper-slide">
                  <a href="#">
                    <img src="./static/resource/MAIN201906181255181321992447490.jpg" width="740" height="460">
                    <div class="text">全省“法治进校园”巡讲团首站——晋中</div>
                  </a>
                </div>
                <div class="swiper-slide">
                  <a href="#">
                    <img src="./static/resource/MAIN201906181011409383792014803.jpg" width="740" height="460">
                    <div class="text">全省“法治进校园”巡讲团首站——晋中</div>
                  </a>
                </div>
                <div class="swiper-slide">
                  <a href="#">
                    <img src="./static/resource/MAIN201906181011411060153107563.jpg" width="740" height="460">
                    <div class="text">全省“法治进校园”巡讲团首站——晋中</div>
                  </a>
                </div>
              </div>
              <div class="pagination"></div>
            </div>
          </div>
        </div>
        <div class="fr">
          <h2>标题内容标题内容标题内容标题内容</h2>
          <p>文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容文字内容</p>
          <img src="./static/resource/MAIN202008041557110934776077060.jpg">
        </div>
      </div>
      <div class="title">选择您想购买的产品</div>
      <div class="tab-bar clear"></div>
      <ul class="tab-show-box clear"></ul>
      <div class="send-bar">
        <h2>请填写真实信息</h2>
        <div class="send-item">
          <span>姓名:</span>
          <input id="xingming" type="text">
        </div>
        <div class="send-item">
          <span>电话:</span>
          <input id="dianhua" type="text">
        </div>
        <div class="send-item">
          <span>地址:</span>
          <input id="dizhi" type="text">
        </div>
      </div>
      <div class="button-box">
        <div class="button button-1" o-tap="send">提交</div>
        <div class="button button-2" o-tap="clear">重填</div>
      </div>
      <div id="copyright">人 民 网 版 权 所 有 ，未 经 书 面 授 权 禁 止 使 用<br>Copyright © 1997-2020 by www.people.com.cn. all rights reserved</div>
    </div>
  </div>


  <script src="./static/js/jquery-1.11.1.min.js" type="text/javascript" charset="UTF-8"></script>
  <script src="./static/js/idangerous.swiper2.7.6.min.js" type="text/javascript" charset="UTF-8"></script>
  <script src="./static/js/main.js" type="text/javascript" charset="UTF-8"></script>
  <!-- 框架script文件 -->
  <script src="./static/js/owo.core.032e33zk8rgf.js" type="text/javascript" charset="UTF-8"></script>
  <script type="text/javascript" charset="UTF-8">
    owo.script = {
      "page": {
        "data": {
          "info": {}
        },
        "created": function created() {
          // 获取分类列表
          var xhr = new XMLHttpRequest();
          xhr.addEventListener("readystatechange", function() {
            if (this.readyState === 4) {
              var newHtml = '';

              if (JSON.parse(this.responseText).code != 0) {
                alert(mess.msg);
                return;
              } // 生成分类列表


              var list = JSON.parse(this.responseText).data;

              for (var index = 0; index < list.length; index++) {
                var element = list[index];
                newHtml += "<div class=\"tab-bar-item\" cid=\"" + element.cid + "\" o-tap=\"activeItem(" + element.cid + ")\"><div class=\"name\">" + element.cname + "</div></div>";
              }

              owo.query('.tab-bar')[0].innerHTML = newHtml;
              setTimeout(function() {
                owo.script.page.handleEvent(owo.script.page, owo.query('.tab-bar')[0]);
                owo.script.page.activeItem(list[0].cid); // 活跃第一项

                owo.query('.tab-bar-item')[0].classList.add('active');
              }, 0);
            }
          });
          xhr.open("GET", "https://apps.people-health.cn/misc/api/rmay/categories");
          xhr.send(); // this.activeItem(0)
        },
        "saveData": function saveData() {
          // 切换前记录上一个数据
          var itemList = this.queryAll('.tab-show-box li input');

          for (var index = 0; index < itemList.length; index++) {
            var element = itemList[index];
            var num = parseInt(element.value);
            var gid = element.getAttribute('gid');
            this.data.info[gid] = num;
          }
        },
        "activeItem": function activeItem(index) {
          var tabList = this.queryAll('.tab-bar-item');

          for (var _index = 0; _index < tabList.length; _index++) {
            var element = tabList[_index];
            element.classList.remove('active');
          }

          console.log(index);
          this.query("[cid=\"" + index + "\"]").classList.add('active');
          this.saveData(); // 获取数据

          var data = JSON.stringify({
            "cid": index
          });
          var xhr = new XMLHttpRequest();
          xhr.addEventListener("readystatechange", function() {
            if (this.readyState === 4) {
              var newHtml = '';
              var list = JSON.parse(this.responseText).data;

              if (JSON.parse(this.responseText).code != 0) {
                alert(mess.msg);
                return;
              }

              for (var _index2 = 0; _index2 < list.length; _index2++) {
                var _element = list[_index2];
                newHtml += "<li><img src=\"" + _element.pic + "\"><div class=\"name\">" + _element.title + "</div><div class=\"info clear\"><div class=\"old fl\">" + _element.remark + "</div><div class=\"new fr\">\uFFE5" + _element.price + "</div></div><div class=\"input-bar\"><span class=\"jian\" o-tap=\"reduce\">-</span><input type=\"number\" value=\"" + (owo.script.page.data.info[_element.gid] || 0) + "\" gid=\"" + _element.gid + "\"><span class=\"jia\" o-tap=\"add\">+</span></div></li>";
              }

              owo.query('.tab-show-box')[0].innerHTML = newHtml;
              console.log(JSON.parse(this.responseText));
              setTimeout(function() {
                owo.script.page.handleEvent(owo.script.page, owo.query('.tab-show-box')[0]);
              }, 100);
            }
          });
          xhr.open("POST", "https://apps.people-health.cn/misc/api/rmay/goods");
          xhr.setRequestHeader("Content-Type", "application/json");
          xhr.send(data);
        },
        "add": function add() {
          var parent = this.$target.parentElement || this.$target.parentNode;
          var num = parseInt(parent.query('input').value);

          if (num < 99) {
            parent.query('input').value++;
          }
        },
        "reduce": function reduce() {
          var parent = this.$target.parentElement || this.$target.parentNode;
          var num = parseInt(parent.query('input').value);

          if (num > 0) {
            parent.query('input').value--;
          }
        },
        "clear": function clear() {
          this.query('#xingming').value = '';
          this.query('#dianhua').value = '';
          this.query('#dizhi').value = '';
        },
        "send": function send() {
          this.saveData();
          var name = this.query('#xingming').value;
          var dianhua = this.query('#dianhua').value;
          var dizhi = this.query('#dizhi').value;

          if (dianhua.length !== 11) {
            alert('电话号码不正确!');
            return;
          }

          if (name && dianhua && dizhi) {
            // 清理数据
            var sendData = [];

            for (var key in this.data.info) {
              if (this.data.info.hasOwnProperty(key)) {
                var element = this.data.info[key];

                if (element > 0) {
                  sendData.push({
                    "gid": key,
                    "num": element
                  });
                }
              }
            }

            console.log(sendData); // 发送数据

            var data = JSON.stringify({
              "user": {
                "fullname": name,
                "mobile": dianhua,
                "address": dizhi
              },
              "goods": sendData
            });
            var xhr = new XMLHttpRequest();
            xhr.withCredentials = true;
            xhr.addEventListener("readystatechange", function() {
              if (this.readyState === 4) {
                console.log();

                var _mess = JSON.parse(this.responseText);

                if (_mess.code != 0) {
                  alert(_mess.msg);
                  return;
                }

                alert('提交成功,感谢您的参与!');
              }
            });
            xhr.open("POST", "https://apps.people-health.cn/misc/api/rmay/submitForm");
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(data);
          } else {
            alert('姓名地址和电话都是必填项！');
          }
        },
        "template": {
          "module12": {
            "created": function created() {
              var _this = this;

              // 轮播图展示区域swiper
              setTimeout(function() {
                new Swiper(_this.$el.getElementsByClassName('swiper-container')[0], {
                  pagination: _this.$el.getElementsByClassName('pagination')[0],
                  loop: true,
                  autoplay: 3000,
                  paginationClickable: true
                });
              }, 0);
            }
          }
        }
      }
    };
  </script>

</body>

</html>